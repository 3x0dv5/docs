.. _rfc82:

=========================================================
MS RFC 82: Support for Enhanced Layer Metadata Management
=========================================================

:Date: 2012/01/24
:Authors: Tom Kralidis (tomkralidis at hotmail.com)
:Last Edited: 2012/09/23
:Status:  Proposed
:Version: MapServer 6.2
:Id: $Id:$

Overview
--------

OGC Web Services (OWS) have the ability to advertise content metadata
associated with a given resource (WMS Layer, WFS FeatureType, WCS Coverage,
SOS ObservationOffering), both inline to the Capabilities document and as
a reference to a given URL (i.e. ISO metadata XML document).

MapServer supports both inline (e.g. ``wms_title``, ``wms_abstract``) and URL based 
(e.g. ``wms_metadataurl_href``) metadata advertising for OWS Capabilities.

Currently, if a given dataset does not have associated formal XML
metadata, Capabilities XML references to metadata (i.e. WMS ``MetadataURL``) are not
available, even though between the LAYER.METADATA/ows_* values and the layer's
spatial properties enough information can be processed to generate a useful XML
metadata document.  The existence of formal XML metadata in MapServer OGC
services Capabilities XML provides value to Catalogue services which harvest
metadata to support discovery.

It is proposed that MapServer be enhanced to support the generation of XML
metadata documents from a given layer's METADATA and spatial properties.

This enhancement provides dynamic publishing of XML metadata for OWS
services for cases where XML metadata does not exist for a given resource.

Technical Solution
------------------

MapServer will have the ability to generate a metadata XML document
dynamically from LAYER.METADATA/ows_* directives and the given layer's
spatial properties.

MapServer will also provide support for output of a service metadata document
formatted as ISO 19119:2005 based on WEB.METADATA ows_* directives.
This is an alternative service description that supports the INSPIRE initiative.

This functionality will be made available through a MapServer specific HTTP
request called ``GetMetadata`` with the following parameters:

* layer: layer NAME
* outputschema: MIME type of outputschema.  Possible values:
  * http://www.isotc211.org/2005/gmd (ISO 19139:2007 [default])
  * http://www.opengis.net/cat/csw/2.0.2 (Dublin Core)
  * http://www.opengis.net/cat/csw/csdgm (FGDC CSDGM)

Calling ``GetMetadata`` with no arguments will return an ISO metadata
document of the service metadata.

Implementation Details
======================

mapmetadata.c

.. code-block:: c

  char * msMetadataGetLayerMetadata(layer)
    if MAP.LAYER.METADATA/ows_metadataurl_href
      return HTTP 301 redirect to MAP.LAYER.METADATA/ows_metadataurl_href
    else
      generate metadata XML based on LAYER metadata spatial properties

  char * msMetadataGetServiceMetadata(map->web.metadata)
    read map->web.metadata
    return ISO 19119:2005 XML

Downstream OGC web service code then implements:

.. code-block:: c

  if !LAYER.METADATA.ows_metadataurl_href
    set ows_metadataurl_href to http://host/mapserv?request=GetMetadata&layer=foo
    set ows_metadataurl_format to "text/xml"
    set ows_metadataurl_type to "TC211"


Backwards Compatibility Issues
------------------------------

There are no compatibility issues with existing mapfiles.

Affected Files
--------------

* mapmetadata.c (new)
* mapows.c
* mapwms.c
* mapwfs.c
* mapwfs11.c
* mapwcs.c
* mapwcs11.c
* mapwcs20.c
* mapogcsos.c


Ticket Id
------------------------------------------------------------------------------

* http://github.com/mapserver/mapserver/issues/XXXX

Voting History
------------------------------------------------------------------------------

